BACKEND IAM SETUP SUMMARY
=========================

Question: "Will the EKS pods have access to call Textract and Bedrock using IAM?"

Answer: YES - After this Terraform apply, backend pods will have IAM permissions for:

✅ Amazon Textract (all operations - document analysis, expense, ID extraction)
✅ Amazon Bedrock (invoke models, agents, knowledge bases)
✅ Amazon S3 (read/write to backend bucket)
✅ Amazon MSK (if Kafka is enabled)

Files Created/Modified:
-----------------------
1. modules/envs/iam-backend.tf           - IRSA role and policies
2. modules/envs/variables.tf             - Added backend_s3_bucket variable
3. modules/envs/outputs.tf               - Export backend_irsa_role_arn
4. main.tf                               - Pass s3_bucket to module
5. ssm-backend-serviceaccount.tf         - Create K8s ServiceAccount
6. BACKEND_IAM_SETUP.md                  - Complete documentation

How It Works:
-------------
1. Terraform creates IAM role with Textract, Bedrock, S3, Kafka permissions
2. SSM document creates ServiceAccount "backend-sa" with IRSA annotation
3. Backend pods use serviceAccountName: backend-sa in their deployment
4. EKS automatically injects AWS credentials into pods
5. AWS SDK in application code automatically uses IRSA credentials

Required Changes to Backend Deployment:
---------------------------------------
Add this to your backend deployment YAML:

  spec:
    template:
      spec:
        serviceAccountName: backend-sa  # ← ADD THIS LINE

No code changes needed - AWS SDK auto-discovers IRSA credentials.

To Deploy:
----------
terraform apply

Then verify:
  kubectl get sa backend-sa -n default
  kubectl get pods -n default
  kubectl exec -it <backend-pod> -- aws sts get-caller-identity

See BACKEND_IAM_SETUP.md for complete documentation and examples.
