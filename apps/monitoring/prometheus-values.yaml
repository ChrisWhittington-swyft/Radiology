prometheus:
  prometheusSpec:
    retention: 30d
    retentionSize: 45GB

    resources:
      requests:
        cpu: 500m
        memory: 2Gi
      limits:
        cpu: 2000m
        memory: 4Gi

    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: ['ReadWriteOnce']
          resources:
            requests:
              storage: 50Gi

    scrapeInterval: 60s
    scrapeTimeout: 50s
    evaluationInterval: 60s

    additionalScrapeConfigs:
      - job_name: yace-cloudwatch
        scrape_interval: 120s
        scrape_timeout: 60s
        static_configs:
          - targets:
              - yace-exporter.monitoring.svc.cluster.local:5000

    metricRelabelConfigs:
      - source_labels: [__name__]
        regex: '(container_network_tcp_usage_total|container_network_udp_usage_total|container_tasks_state|container_memory_failures_total)'
        action: drop

      - source_labels: [__name__]
        regex: 'etcd_(debugging|disk|server).*'
        action: drop

      - source_labels: [__name__]
        regex: 'apiserver_admission_controller_admission_latencies_seconds_.*'
        action: drop

      - source_labels: [__name__]
        regex: 'apiserver_admission_step_admission_latencies_seconds_.*'
        action: drop

grafana:
  enabled: false

alertmanager:
  enabled: true
  alertmanagerSpec:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi

  config:
    global:
      resolve_timeout: 5m

    route:
      group_by: ['alertname', 'cluster', 'service']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 12h
      receiver: 'sns-webhook'

    receivers:
      - name: 'sns-webhook'
        webhook_configs:
          - url: 'http://alertmanager-sns-forwarder.monitoring.svc.cluster.local:9087/alert'
            send_resolved: true

defaultRules:
  create: true
  rules:
    alertmanager: true
    etcd: false
    configReloaders: true
    general: true
    k8s: true
    kubeApiserverAvailability: true
    kubeApiserverSlos: false
    kubelet: true
    kubeProxy: false
    kubePrometheusGeneral: true
    kubePrometheusNodeRecording: true
    kubernetesApps: true
    kubernetesResources: true
    kubernetesStorage: true
    kubernetesSystem: true
    kubeScheduler: false
    kubeStateMetrics: true
    network: true
    node: true
    nodeExporterAlerting: true
    nodeExporterRecording: true
    prometheus: true
    prometheusOperator: true

kubeStateMetrics:
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

nodeExporter:
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

prometheusOperator:
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
